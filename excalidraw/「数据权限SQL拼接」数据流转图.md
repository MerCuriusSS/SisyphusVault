---

excalidraw-plugin: parsed
tags: [excalidraw]

---
==⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠== You can decompress Drawing data with the command palette: 'Decompress current Excalidraw file'. For more info check in plugin settings under 'Saving'


# Excalidraw Data

## Text Elements
DataPermissionHelper.setPermission
将@DataPermission注解存入ThreadLocal ^SlfQWwbl

mapper ^kMQBLkiH

DB ^ma8GdmCo

1. 用户发起查询 ^De78ViVn

Mybatis-Interceptor ^zPcLcT70

2. 检查@DataPermission注解 ^zFbOEsl8

3. UserContext.getUser()
(获取当前用户信息) ^ZVSrJ39G

4.buildPermissionSql(annotation, user)
(生成权限SQL如dept_id=1001) ^olypZxCt

5. appendPermissionSql(originalSql, permissionSql)
（拼接权限SQL到原始SQL） ^gGJwsIEV

%%
## Drawing
```compressed-json
N4KAkARALgngDgUwgLgAQQQDwMYEMA2AlgCYBOuA7hADTgQBuCpAzoQPYB2KqATLZMzYBXUtiRoIACyhQ4zZAHoFAc0JRJQgEYA6bGwC2CgF7N6hbEcK4OCtptbErHALRY8RMpWdx8Q1TdIEfARcZgRmBShcZQUebQBGAE5tAAYaOiCEfQQOKGZuAG1wMFAwMogSbggAZXwAMwBFAHUKTXx0sshYRCqoLCgO8sxuHgA2bQAORIB2Cbn4iYBmAFZE

xenl/nKYbmdlxYAWbVmDlPiUg/3R1fityAoSdW5FieXtZaTpjcXElNGeTbFSCSBCEZTSbjLFJ3CDWZTBbjQoEQZhQUhsADWCAAwmx8GxSFUAMTxBCk0mDSCaXDYDHKdFCDjEXH4wkSNHWZhwXCBXKUiB1Qj4fDVWAIiSCDz81HorFNR6SEYwmWYhCimDi9CSyowhngjjhfJoW7Itjc7BqHbGlJIzoQenCOAASWIRtQBQAujC6uRsi7uBwhMKYYQm

VgqrgAHL8hlMg3MN2B4PIsIIYjceLxRYpF42s4wxgsdhcY3TAtMVicSOcMQZtbxA48RaZxIh5gAEUyfXTaDqBDCMM0wiZAFFgtlcm7PTChHBiLhuxnpqNEqNZsseCkNxMYfjaWnuH38APkX1MAMJO2F7gAApMfSEBPFgASQUQpG0YSgd9ID6fnAAHQ4QAwHQAASvKIfz/SsOEAC5tAGPIwANbUAU0UABVJECXBiAAGTYdwY0oVD+iqCDb3vR8YNf

fB30/BBv3I/8OCAsDSKgijiwQlD0MwnC8IIfk6k4KBqkIIxxF4W1ykE3IADFcAffArVQQE7TPKAAEEiGUEt0GCOoBnLUgoHMAhNLBHToDNfk9FyXBQyYf00CTfAYQJMFQwIIjzxI682MYqiaK/PyYOY8DfIYmDOLQjCQl4/CYVwIQoDYAAlcJRPEtEhAQXd7NfMEIWNbQARhSRQi8qBsNDDFD37HLkSIDgaqcoN8GKABfLZSnKSoJCMABHXB4n6u

onRS/lunEiBAmwKIOHhJAYWGNBnHiHgjhzLMDkSV4zh4RIDlGGElPORZxnW0Z4g+CYxm+FTygeYgnjQTdxn+S71hSHamxu+7gVBcEL1QHbtFGCZpgbFIlg2TcUj4ZE4U1SSBDRVUWQJYlyTJRbkWpWkHUZZk8Qx9lyA4LkeRyAzkUFYV1U1FE8R1FNUblBUlRZ2U1TFKbtXTXVhH1Q0M1c81LQzG0YQJ51XUKL0ad9BBHNQZyQzDZb0E0G0Y2HYh

4zdbrykm54gU6lMEAPNBTkzZcoRNO1CxgyFFkMmDqw4WtjV+ZtRlOP6Kg7LtLdQI8TztIdCbHLIqanIESjjrp4CmtTKR6nt0AxABZBoACFsIxQhnwgOOzc6eOy8gXr0GIFIR0IJp1P0VDU8TnoJB5dEqBLoF5btWd50XUsV2+RIeAmA4JiOhrqoDVrdzwrF09DhAOq65Eq4gLPc/zwuJqT3piKW3Z9m0RYXgBFZszORsDmOiXpkWVIpmmHhX8uD4

VhhR7ntQa5ip+A6BxLgTBtLMe25QQQFSBiVBG80kbKlZjiYmbJ0AkmxhSQcNI6SxiJqyXoZMKa8mpnaWmIoeZVD5tKRB8onqKheggrm9NeZM35siPUkh9Yi1NGLWAEtkb2gZDLKcvcpKK2Vqrde6sqha3iDrQmnCWrJjtKmdOyw1FLFXJmV2xYlzaKrDWcSsMfgnH2G2TswRB4hzqoOXWUcJx5Fnko8o/cFzB3iMuGY+xR7j0nvPfcS9rGnmIhIf

QuA4DvgIhQCqVRQnhKYAJISIkxIjH4dJKAckFJKX9mpMy2kqhiFyPEwyxl3C5Isg+YgxAEQwhslEeypBlYQAGkNEaY1+RuX8J5YJ6BYkRISklVK6VkloCyvVO0jUED5UBhmYq/syrMAqlVJqtVjwrzKKXcuacqhGCMIsHOygUrYgAFJ7zbugGac0Fr8g1qtE+iwx43T2jtHapjkQnQfkcW2owcwTCSIkVcO5kTfzobwK6kwvj/IBDwBsZ1DilQBo

VVAmYjjnAhh8KEBxzgfASnA8S/CVRYnRigiAaCsb8jxtg3WRL8Gcm5EQgSQoyEamYVKBhqoaE/3hsoxBTCKEsLkULBMXC7RmhpOLa0/DpYumEd6MR6cJF2lDMQcMEgtY8DkXGYWaBDat3EosU2yoLbp03NMIBTZ4ijBdsiR2Oi0DZitQ7CsxZ3ae1/iA9xWY1FmKDgE1ZNjI7jhjoUOOOrdUH28ncLZITcATAAOLEH0LiYuZcNllFDRUdOEBiAAC

sMQyRvIsI5dQW7QH3u3Ugndk2dHaj3Gcc5XHp3ccPZYlx7m/C5eURqzUVZzwagvYOy9V7FENhmmJMb42JrYKc5Oh9kQ3O+ccf5vzX4vyhH8U1d9SzTGSM2RI7jEjLBfhcNYX92Z2pSJMP5y4QGjF9n8GBdpIHTJev7RGeK2WEuQZjdBONw5YIJkyalpNaWUz5N6RlvKJT8o/QgDlIKO0o0YeQqDrK2GCw4VqpFosxW8IlVLQR0q5ayvkkreVvbFV

SNVTmDVetMMKvKCojMm4DjZlNUsPROkmz8Jtfoj24l3HrF+VCT+69A4WIHYE8OtjA2TkcS5ZELjLFNs8a2/acM/GLxWWHI23SIDthzpE6Jl4DPekSRlFJpnZLySFFkmEOStIWQKX0QkxSTL4DKTEkgVTf3lFqXZA0DTM07L2Qc457TSDuQ4F07yxn+SJWSmlVgwzUCjNygaKZiL4izNKuVfoSzu2DvWWvRVmaa51wbk3adEYK1sCoEfFa61JiHRW

JPJYTYIYOu2NwPd4x3EPzOPclcvtT20MRMcATa1343xeF8eFUCJbJD+HMDF/zZgHpxVctA+LEFAdQVjDBuN/04N29AAhdKqYMrpshrU0HObsrPbwGDkGbuobtOwhRWHuE4ZOpLZEUrZZoGnArEj4jyM9Uo5rLcNGPs6tLWcngBrzZuKuNe14HHnYcZdfxuYV9rjuO9eJ312mqTSejrJxR8m+71qUx4keY8J5lmnssinGmJN+uRHANgoYHGA7jkUC

uyMygpDjiIso/Oy4Xohg/Sbajpvg0ZxXc4i2wa7W2jMKYywRe1pZjyKAOclWhmUHJmEORiD66ZIb7gsPMj2Mac04ao1xqRogPoNgyqqgEk0GoVOApCCYDTDeLnfJecC+0BPFHXx9qvyzNuyNYAL3h7Ol8F+o9oUrE12XD0iPuW6/UjVigIIsLG+RKbvPndC+Zo7rV/kQQhwUDZ8Tl3bBGCZxIIH7nzB5TqDsRd3sdUh1pvXpmzsswABqhBR9cDs2

W9AKd6uoGXP/G+QDXifFbG87rvyw+YrGEN/5mKp52mBRmTF2h/lLoOKataSvb7IifYih95Q32Ihgyd0l2NyVHapV+4D5NztgZpgg2u0ZlewY2oQewQxRB5WAMoQFj8AwyFWNGwwtFwyRV+ztH+xlWBz9DIycUrghwgC1lGGhzozBwECNQlkPV9gOn2nR2NDhWtSdV41dSzGhX+DmD3QJzogbzGXKAjlHBkx5x7TwIgEUzcVpxbWuhfnAUgD3E0z7

3Z1Ul0yy1QEAApXQAdiNABF5UAHdYwAU/NAAj6MM2UO0DUK0L0MMMs2EnMxelSSEgyRs0hDs36A8wkD0mIXKELBKVMgc16CshqSEn8wclwMp3KA6Q8nwCM3QBUI0J0IMLiwGUS2sJS1IGyjS0mQRSBiy0f2BFy3PHyy0zWTAA2RHQ3mfBvBSlGEjCdAAHkTNTwZ9poEBZpn959VpGx3gVgLVXhPpLVlhD8utjQV0w8vp/hNwroWt/Zj8Xp3Ew9YY

Lh1hoUGc5tn00Dpgz8fgtwzgQEdoIZIDn8ttX8f89sf1P98ZjsjjTsQN6VwMrtmU+VQDEN7tRt6E7ssRnsQDmY3t0MPsZCIBRUUCftJUCMAd3RRcBQ5Vi8KNlUNZCCUhpgSDEDUBYdjY7Vs8GMKCvYpg5g1t19HUixOARgxhMcDElxfhDpb0swuDLFl5/UBCychDxdB8K44cZ0I0E5R0+obxsBsJsBUJpg0gS5I100N4c080C0i0S0UT0Aq8u4U0

hT2SN5UIMRsBM4RxMBiAnd2SpTYR88q11ltcqcB5xDm1LgeBZgcw0tu16NZD+0idCjiih9tkuSeS+S0hp8zloBZ07QblWDjhrgoYJ4Vwtw+jN0kUxgJhwU91L8sVXhICpikUZhIzoYcwPox5liH9X1cUX9XikE8EJB38Ds/0zjv88zZ8ztQN3DIBSF3jYCcy4MOZuUkM7iUNPjyh3tMNfj/jxU0CgTHRCNAcwSfQQdgi1ZoTpE4TR8ETEwyCUQMS

kV1gwYbQDpcSPCmDON0DVz8SOAsduBb1X5vl/gVzK4xNuC7TaTiAe9ydhCQjIAxDG0JDTTzTOsbT/ECinCYt0BM4YBqRjJmBnAnRClRAEA4BkoXM2FCJdMvyfzHx/zAKxAQKMZLCklDFbCrNMlHCglzwXD0AnMilGCjI3NsKXcvNqlkQ/N6lGkyiKiqjajwtItosgYIAoKFwYKALnN4LQL4iEshlMoUjeDZC8oMiZlsipBcjKoZ4FCwgB9NlK5M0

lSVS1SNSqty1K1Wix5Zjl0GdDhNFnyIATpxjT4DoswrpJ5JDb8j8HtzoDpx4oQyTDp6d0ygZLVUgrptoLgHk1o5gNt4Ecy399sfMqQv9CYTsOQ/8KzLsmUGZazGynjOUnsYDbsvj4CfjkDuzzhezZx+zQTiMcDITwcxyqNEgpyrc44WSRg0TyC3EzoPh+Smx/YeMdIsxuM1ydy0A1F/TfhfjHxzFTy3zcZSd7FpyRC7ylwTSNxzTzLO0JLrzWczy

Ocg8GS+cE5Bd48RdI1GSygrKJ5LgvoLh7Lx449nKzgW0ySPKHktdOgwTURddzdHB5o8rIBTdbrLdtVSqbcqZKLyjKiai6iy4m93cJBPdvdndBR/diB29g93Rlr3ht01x35djL97k/ohdZicwAQzVwYNwwYM9LqKqoDc988K8HqMAmQy9asiaVLq8Td8A68eCYRXcW828FrO81BJBLygZCsijiso1q5c181C1i13SpoZTrldhDhjgAROqFhfkDo1F

/YTpDhxhDhJ5pDVxDhD0Rsf4L01wmx9paqwYrplhwZHLngvgw8LV6x/hqq1pvL31fKLiCyArCCgrAMLjQrCELsbjIqWVWzHi2ZnjHscyazEq2zviOzUrUD0r8M+yQSgcSEISWdJECrId1JirXq/qpSEdq1DU3FTgvh/gjaFdNynYXptpiS+MMwPgVwgEvEqS6b+qA16ShqbzRDqdjSVN9g1NdKu1ia5D667ROcO9g0y4Nr4849hdM91qE5nBtaX4

219ahNC6491g1iD9Lamw8cs7cbLqEEbqDd7r067R3rchPrqKfqfdXcAb0AgbKyqy/cA8Frh6Jcw8ZgWN0U90GwgEgFx73g4Y+jtqoZXh2qcaygs9s6S8mRnqD6kS3rBC7ddl9lDkTlndL6pob6fdQaH7ucn7OgL1JDlw8cswZgOtAVQ9LhGwz4J5J44Z6cVgLqisdcjIyaC9YpibS9CbWHKa6sS8abat+7ygGaEBW9wbmau82bBCCjpKSigsZJNB

qiRxmB8AJhlLZ8vShgRgsttp1hThGxrKzSzTQysxnLflJtTpNwbpdL4yzTH4VgdpLUx41o5khKX1bbsyYrP1SySV/LTjKVgq3byzrjADbioqQ6/bYMID4rmyXtfbpow7ETOyeFATo7MrY7ByE6Zqk6VVIdfrQ75FSCRDGM0AXkcwD1MU6CF9SHi7nUSTjRsaVgD9/ZuqfU+qpNG7BriaRqh4O7Th11ZqWmdMPyIA4hUBAABi10LCkggig4ngiMMG

eGbGYmbIl/HYk4AQgSVyGQosxpjsOs0UgwqUKwp8NcIQH0n5E8MIqOdnz8LIoCIopHNNAi06QiN03mfGdYimdWZmf6W4qS14tSKZ3SPmyKhEvmUWWms5odJKyqAAC1R9qhSAjkfhY0VHPS2TvSRhH5Vxlw4Yk9vgsTDGgFxgdHXooY/htpJr7gIDtoOidpzgFg/g71+j/ogXlJ+F9jUBtsuY/KTjMFiy/HPH3b/9KzfdgmfbWF3HwmA7ICCVuYom

PjxXcnBU3QEnvs+FkmhEiNsDSNialUsnYTsQ06MnlE5yFgsbmxmxynr9y6WD9hkVL8NbRMerqTJM+CBqg1E7DSG1RrunHH+E+65qDnGLH5UAABVMIUgXEQpc8bQZQOiMNpgAACgAEogIE3AB24MADXlQAZX1ABZJQ0MAEP5QAewMk3Zmg2TD42I2hJ+gY243w3k3U3M3c2C3i31mrDktNxLD7C9m2r3yNJLmIA3CzmmAvD3N+3ko4BrJbmAtQcRC

wiotnnBng2K3I21Ia2oAK362OB03s2831Ci2S3vnBlfnuBUsAWMtMjss78xL8jJL7TubZKPdFI4BoXMBsRhXtS5851ng8HtwfFMwW1DgzpDH9g3hWDrH1ovgrhNaQUzojgWNVwZgxg+iQXnHWXXGDj7bPHHafGANcESYyyrjPagnvb7iYmZX6yXiJXg6HjYnkrw6vsAS1W/tgSsD47hydWCCtZ2xDXrTZy3F/kVhfYWMi7IAGqJYmWGAWqangYJ5

3E/hKTHXmnb3zz2bm660jT7yxqgEfY+nlPMLGKjhNAhAhRwaPmOBqh+p8AE3rAOA2AohjJOBqBUAhBw2U2t3AB8V0AAQjQAYXNAAFNOqAaGwkACDNZVECgAfRIAAF50r4gD3wKoldNDPjP8BTPlnGILOrObO7OWLHPnPXPU2vO/OAvgvQuoAIviBoubRYvW3NmbDO3dnbN9OiLB3XNSkx3rm7RyLp37mRVHnwjIiIAkuTPgpiwMvrOOBbP7PiwnO

XOmA3OE3Cv/PAuQvgKyuouYu4u7R4sj2kjT3xlBKWWsi5lr3wX+8GGmSeb7RY0jkKBmAnQRxJyhbw1hWNZ7lT4PgdpVcJ5AFDH/TUhTVqCpcMUJP4zDpkgZgD1O79zkOnGWWoR0OOXDisPvHeXfHXaBWAmiOSEgC5XoqwCuYKPA6qOEqaP2z4mI6knmOY7WPRF2OPX8q9WtYRweOZzCmkVTXMUjKjzJOtyMx7lrX+MW1/gkho866A3XW2n3WjXnE

27NPunfZ2M+1Xy9PA2qg3hUAwlEAmQRvOAxu52CAMunP3xoJRvLO3PAAIf8AB+jQAUuMivAvAAGJUAHzlQAac1ivABIf9LbV5MM19Nx1/M8s4Tf15FEs6N7M4y4t5t7t+wid9d8C496QqSI7e2bQocJ7aa/7Za/wpHaIvHcndsjueJqD4G/V59+17D4D6D8N9QGN5Wf9/wAj9t6W+j5d/d64p2+Sz26mvS1Q6O5ywWTy1O9WSkcdIkFHxkjOA4Bg

GUAAE0LVY0AANBoUgZYZgEN2aUfbAFFiZUWhrcYOYb5LcBYN+I2tcYDqYY4ZcJPSeMYc16DpcN4WYX2H4MeW9ZdXS+/IGI4Au0eL4f955M+TMptkR6Yd8OXjHlodj5bo9QBgrcKl7Wo5kdwCUrSJiE1J5xNlWFPJjhgRY6as2OuVenvgWTqwkZIhrZEjPi3pc0kc95FsCxm+T1U1y3AU4AL2eC3ppCFwRpieUsSd8SckvK8rx06ZIoHyHweDn62m

q8d/W/TSAIPSvIbVR6K1CejvSWqK4NgxwSePBxf4G0mwceL/pLTNIQwro//OhpngNJgE96FuaBrxyer70jc+A/Gkww4ZF4bB7DcvJw2l6SC8QU/Akrew6jgBe4sIcJKKFcQlUjYIIbIFUC0gQgtgDAQgAgAoA5wXaeHYlESDqDJCUhgwCANgBEBEInQfQfQKKC5YO0UexQdIZkI+o5C4hkAhITSjCqBNfMJQk+jkJkg48UBrZYoRWlKFZA8hsVeD

JEIyFtD6hHQ6ArjxDqtCshOQlKGgOFSQBehowrINUUSaYCphdQqANkKyAyQdm6FNPrUL6HLCGhZmdtpJBGHtCm4zhDPic3cKHD+huQqIHYOcEODpeFwnYVkBHCk17BleXUj0KWErD9AzDVCA0RwRpDphRwmSIrHGGah6MKIbAOiGFDz9uAD8NYmPB+DZhrgcwc1JEOYCQi8Q+AafrsG+RrE/6dLVYEJw2CRCjAbAAwEEI8IEBsoY2PoqsGXDSUHh

Xw8YXk0RK0cmQaQ+kCQFq4SRIhnI4gKKGAr7NIAfIzOG7gQDPDcAbQfhgIhIC7YR0OcPEJmlIDKBqQCbaFGWFBQaj1RTnPBpt3KBpRlAQYHkFUGVGqiuMTnc0bwGzA6j3gJbBkYCI2aII5hDncmHlXBIkY0oYYCLNAxHQ5BJRwQdOFwPSFEAJ2IyPijCCiyhCwx/zEVElG37Rj+KLuHkFiFICRgSMJ7cMciFCSkAUxEoqUYGL4oMi7A2aJonkGqB

RY4Aoo5VHmIDH9NYQs0QgIwFQhkj2gh9MNBKEyANiCSNSFzslCbgz4xBtpCQeCQMDVBOxLo4cfgFCAaQGxTYlsXJgZGOBmA/opBFGygCZwcgQgSRhQLvrBADYNadqEAA
```
%%