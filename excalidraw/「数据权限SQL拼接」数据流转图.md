---

excalidraw-plugin: parsed
tags: [excalidraw]

---
==⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠== You can decompress Drawing data with the command palette: 'Decompress current Excalidraw file'. For more info check in plugin settings under 'Saving'


# Excalidraw Data

## Text Elements
DataPermissionHelper.setPermission
将@DataPermission注解存入ThreadLocal ^SlfQWwbl

mapper ^kMQBLkiH

DB ^ma8GdmCo

1. 用户发起查询 ^De78ViVn

2.执行SQL查询 ^KcoSJSax

Interceptor ^vcty66Y9

UserContext
(threadLocal) ^jMM5roO0

JSQLParser ^KVQF2PC8

3.拦截原生SQL ^SrbhQKDF

4.获取用户权限信息 ^KkGHhbRj

5.解析SQL并拼接用户权限SQL ^qQ2TI1JN

6.执行修改后的SQL ^dPFpknoG

%%
## Drawing
```compressed-json
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
```
%%