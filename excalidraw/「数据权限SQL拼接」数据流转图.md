---

excalidraw-plugin: parsed
tags: [excalidraw]

---
==⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠== You can decompress Drawing data with the command palette: 'Decompress current Excalidraw file'. For more info check in plugin settings under 'Saving'


# Excalidraw Data

## Text Elements
DataPermissionHelper.setPermission
将@DataPermission注解存入ThreadLocal ^SlfQWwbl

mapper ^kMQBLkiH

DB ^ma8GdmCo

1. 用户发起查询 ^De78ViVn

Mybatis-Interceptor ^zPcLcT70

2. 检查@DataPermission注解 ^zFbOEsl8

3. UserContext.getUser()
(获取当前用户信息) ^ZVSrJ39G

4.buildPermissionSql(annotation, user)
(生成权限SQL如dept_id=1001) ^olypZxCt

5. appendPermissionSql(originalSql, permissionSql)
（拼接权限SQL到原始SQL） ^gGJwsIEV

%%
## Drawing
```compressed-json
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
```
%%