---

excalidraw-plugin: parsed
tags: [excalidraw]

---
==⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠== You can decompress Drawing data with the command palette: 'Decompress current Excalidraw file'. For more info check in plugin settings under 'Saving'


# Excalidraw Data

## Text Elements
DataPermissionHelper.setPermission
将@DataPermission注解存入ThreadLocal ^SlfQWwbl

mapper ^kMQBLkiH

DB ^ma8GdmCo

1. 用户发起查询 ^De78ViVn

Mybatis-Interceptor ^zPcLcT70

2. 检查@DataPermission注解 ^zFbOEsl8

3. UserContext.getUser()
(获取当前用户信息) ^ZVSrJ39G

4.buildPermissionSql(annotation, user)
(生成权限SQL如dept_id=1001) ^olypZxCt

5. appendPermissionSql(originalSql, permissionSql)
（拼接权限SQL到原始SQL） ^gGJwsIEV

%%
## Drawing
```compressed-json
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
```
%%