
#  ğŸ”´ mavenæ¨¡å—ç®¡ç†
>[!important] ã€ŒPOMæ–‡ä»¶ç±»å‹ã€ VS ã€Œjaræ–‡ä»¶ç±»å‹ã€
>**POMç±»å‹`<packaging>pom</packaging>`ï¼š**
>æ ¸å¿ƒåœ¨â€œç®¡ç†â€â€”â€”çˆ¶é¡¹ç›®ï¼ˆç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†&æ’ä»¶é…ç½®ï¼‰/èšåˆå­æ¨¡å—ï¼ˆmoduleç®¡ç†&ç»Ÿä¸€æ„å»ºï¼‰ï¼›é™¤pomæ–‡ä»¶å¤–ä¸ç”Ÿæˆclassæ–‡ä»¶ï¼›ä¸èƒ½åƒjarç±»å‹è¢«ç›´æ¥ä¾èµ–ï¼ï¼ï¼ä¸èƒ½åƒjarç±»å‹è¢«ç›´æ¥ä¾èµ–ï¼ï¼ï¼ä¸èƒ½åƒjarç±»å‹è¢«ç›´æ¥ä¾èµ–ï¼ï¼ï¼
>
>**JARç±»å‹`<packaging>jar</packaging>`ï¼š**
>æ ¸å¿ƒåœ¨â€œä¸šåŠ¡â€â€”â€”æ‰“åŒ…æˆjarï¼Œå¯è¿è¡Œã€å¯ä¾èµ–ï¼ˆMaven é»˜è®¤ç±»å‹ï¼Œå¯çœç•¥ï¼‰


# ğŸŸ¡ æ¨¡å—åˆ’åˆ†è®¾è®¡ç†å¿µ
>[!important] æ¨¡å—åˆ’åˆ†
>**ä¸»åº”ç”¨ï¼ˆadminï¼‰ï¼š**æœ€åäº¤ä»˜çš„åº”ç”¨ã€æä¾›ç»Ÿä¸€å…¥å£ï¼ˆæ‰«ææ‰€æœ‰ä¾èµ–åŒ…è·¯å¾„ï¼‰ã€æ•´åˆæ‰€æœ‰ä¸šåŠ¡æ¨¡å—ï¼ˆä¿è¯åŠŸèƒ½å¯ç”¨ï¼‰
>
>**åŠŸèƒ½æ¨¡å—ï¼ˆcommonï¼‰ï¼š**
>common-coreï¼šåŸºå±‚å·¥å…·ç±»ã€‚
>å„ç±»ç»„ä»¶æœåŠ¡ï¼šåºåˆ—åŒ–ã€redisç¼“å­˜ã€satokenã€æ•°æ®åº“æ“ä½œã€çŸ­ä¿¡ã€å¯¹è±¡å­˜å‚¨ç­‰ã€‚
>
>**ä¸šåŠ¡æ¨¡å—ï¼ˆmodulesï¼‰**ï¼šä»£ç ç”Ÿæˆã€å®šæ—¶ä»»åŠ¡ã€æ¼”ç¤ºã€ç³»ç»Ÿç®¡ç†æ ¸å¿ƒæ¨¡å—ï¼ˆç”¨æˆ·ã€è§’è‰²ã€èœå•ã€éƒ¨é—¨ç­‰ï¼‰
>
>**æ‹“å±•æœåŠ¡ï¼ˆextendedï¼‰**ï¼šç›‘æ§ã€åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡


# ğŸŸ¢ é‡ç‚¹æ¨¡å—æ‹†è§£ ï¼š
## ä¸€ã€åŠŸèƒ½æ¨¡å—ï¼ˆcommonï¼‰
>[!important] è‡ªåŠ¨è£…é…çš„ã€Œstarterã€å¼æ€æƒ³
>**ç›®æ ‡**ï¼š1.å°†é€šç”¨æ¨¡å—æ‹†è§£æˆå¯å¤ç”¨starterï¼Œå®ç°æŒ‰éœ€åŠ è½½ï¼ˆç”¨åˆ™åŠ è½½ã€ä¸ç”¨åˆ™ä¸åŠ è½½ï¼‰ï¼Œç²¾ç®€ç¨‹åºåŒ…ï¼›2.æ§åˆ¶é…ç½®ç±»åŠ è½½é¡ºåºï¼Œé¿å…å®¹å™¨åŠ è½½æ··ä¹±ã€‚
>
>**æµç¨‹**ï¼š@SpringBootApplicationå…ˆæ‰«ææ‰€æœ‰jaråŒ…ä¸­çš„importsæ–‡ä»¶ï¼Œç­›é€‰ä¸­æ ‡æ³¨æœ‰@AutoConfigurationçš„ç±»ï¼Œå†é€šè¿‡@ConditionXXç³»åˆ—æ³¨è§£ï¼ˆä¾èµ–æ˜¯å¦å¼•å…¥ã€Beanæ˜¯å¦åŠ è½½ï¼‰åˆ¤æ–­æ˜¯å¦åŠ è½½ï¼Œæœ€ç»ˆå®Œæˆé…ç½®ã€‚
>
>**è§„åˆ™**ï¼šæ²¡æœ‰åŠ @AutoConfigurationæ³¨è§£çš„ç±»ä¼šè¢«è·³è¿‡ï¼Œä¸æŠ¥é”™ï¼Œä¸å½±å“å¯åŠ¨ï¼›@AutoConfigurationé»˜è®¤ä¼˜å…ˆçº§ä½äºç”¨æˆ·è‡ªå®šä¹‰é…ç½®ç±»ï¼›ä½¿ç”¨@AutoConfigureBefore/Afterå¯å¼ºåˆ¶æ§åˆ¶åŠ è½½é¡ºåºï¼Œä¼˜å…ˆçº§é«˜äºå®¹å™¨é»˜è®¤ï¼ˆæ— è§„åˆ™éšæœºï¼‰é¡ºåºï¼›


## äºŒã€ä¸šåŠ¡æ¨¡å—ï¼ˆsystemï¼‰
>[!warning] **æ¦‚å¿µå˜æ¸…**ï¼šã€Œæ‹¦æˆªå™¨ã€VS ã€Œè¿‡æ»¤å™¨ã€
> **èº«ä»½**ï¼šè¿‡æ»¤å™¨ï¼ˆfilterï¼‰æ˜¯**servlet**ç»„ä»¶ï¼›æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰æ˜¯**springå®¹å™¨**ç»„ä»¶ã€‚
> 
> **èŒƒå›´**ï¼šè¿‡æ»¤å™¨ï¼ˆfilterï¼‰æ˜¯è§„åˆ™æ§åˆ¶æ˜¯ã€Œ**URL**ã€çº§åˆ«ï¼Œæ— æ³•æ„ŸçŸ¥ä¸šåŠ¡æ–¹æ³•ï¼Œæ‹¿ä¸åˆ°Springä¸­çš„serviceã€springbooté¡¹ç›®ä¸­filterçš„è‡ªå»ºæƒè¢«ç§»äº¤åˆ°springå®¹å™¨ä¸­ï¼Œå…è®¸æ³¨å…¥ã€‘ï¼›æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰æ˜¯ã€Œ**Method**ã€çº§åˆ«ï¼Œé€šè¿‡`handler`æ„ŸçŸ¥controlleræ–¹æ³•**æ³¨è§£**ï¼Œå¹¶èƒ½ä¸æ³¨å…¥**Spring Bean**ååŒå·¥ä½œï¼›æ§åˆ¶æ›´ç²¾ç»†â€”â€”æ¶µç›–`preHandle`ï¼ˆæ‹¦æˆªï¼‰ã€`postHandle`ï¼ˆç»“æœåŠ å·¥ï¼‰ã€`afterCompletion`ï¼ˆæ¸…ç†ï¼‰**ä¸‰é˜¶æ®µã€‚**
> 
> **åº”ç”¨åœºæ™¯**ï¼šè¿‡æ»¤å™¨ï¼ˆfilterï¼‰æ§åˆ¶â€œ**é€šç”¨è§„åˆ™**â€ï¼ˆè·¨åŸŸã€è§£å¯†ã€XSSï¼‰ï¼›æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰æ§åˆ¶â€œ**ä¸šåŠ¡è§„åˆ™**â€ï¼ˆæƒé™ã€æ—¥å¿—ç­‰ï¼‰

>[!important] è¿‡æ»¤å™¨çš„æ§åˆ¶æƒæ¼”å˜â€”â€”ã€Œä¼ ç»Ÿwebåº”ç”¨ã€ VS ã€ŒSpringbootåº”ç”¨ã€
>1.**servlet**æ˜¯webåº”ç”¨**åº•åº§**â€”â€”å‡†å¤‡webè¿è¡Œçš„ä¸€åˆ‡åŸºç¡€ç»„ä»¶ï¼ŒåŒ…æ‹¬è¿‡æ»¤å™¨ï¼Œ**spring**å®¹å™¨æ˜¯ç”¨æˆ·åˆ›å»ºå®ä¾‹çš„**ä»£å·¥å‚**â€”â€”å‡†å¤‡ä¸€åˆ‡éwebç»„ä»¶çš„ä¸šåŠ¡Beanï¼ˆServiceï¼‰ã€‚**springMVC**åˆ™æ˜¯springå®¹å™¨å†…**ä¸“ç²¾**å¤„ç†**Web** ç›¸å…³çš„Beanï¼ˆControllerï¼‰
>
>2.**ä¼ ç»Ÿåº”ç”¨**ä¸­å¯åŠ¨é¡ºåºæ˜¯**servlet->springå®¹å™¨**ï¼Œå› æ­¤springå®¹å™¨**æ— æ³•**å¹²æ¶‰è¿‡æ»¤å™¨ï¼Œfilterç”±servletåˆ›å»ºã€‚
>
>3.**springbootåº”ç”¨**ä¸­å¯åŠ¨é¡ºåºæ˜¯**springå®¹å™¨->servlet**ï¼Œspringå®¹å™¨æ§åˆ¶èŒƒå›´å¢å¤§ï¼Œå…è®¸å°†filter**ç¡¬å¡**åˆ°servletä¸­ï¼Œèƒ½ä¸springå®¹å™¨çš„å…¶ä»–ServiceBean**ååŒ**å·¥ä½œï¼Œæ›´å¥½å®Œæˆâ€œé€šç”¨ä¸šåŠ¡â€å»ºè®¾ã€‚

>[!example] è¿‡æ»¤å™¨æœºåˆ¶ä¸åº”ç”¨
>
>ğŸ”´åº”ç”¨åœºæ™¯
>2.é‡æ–°è®¤è¯†
>| **ç»´åº¦**   | **æ™®é€šç®€å•æµç¨‹**           | **RuoYi-Vue-Plus æµç¨‹**                     |
| -------- | -------------------- | ----------------------------------------- |
| **è°è¯»æµ**  | åªæœ‰ Spring MVC è½¬æ¢å™¨è¯»ä¸€æ¬¡ | **Filterè¯»**ï¼ˆè§£å¯†ï¼‰ã€**AOPè¯»**ï¼ˆé˜²é‡ï¼‰ã€**MVCè¯»**ï¼ˆä¸šåŠ¡ï¼‰ |
| **è¯»å‡ æ¬¡**  | 1 æ¬¡                  | **3 æ¬¡åŠä»¥ä¸Š**                                |
| **æ•°æ®å½¢æ€** | åŸå§‹æµç›´è¾¾ Controller     | åŸå§‹æµåœ¨**åŠè·¯**å°±è¢«æ‹¦æˆªå¹¶æ¶ˆè€—äº†                        |
| **å¿…é¡»æ–¹æ¡ˆ** | ä¸éœ€è¦åŒ…è£…                | **å¿…é¡»**ç”¨ `RepeatableFilter` å˜é­”æœ¯ï¼Œè®©æµâ€œå¤æ´»â€     |

>[!bug] æ‹¦æˆªå™¨&è¿‡æ»¤å™¨åº”ç”¨â€”â€”ä¸šåŠ¡æ‰§è¡Œé“¾
>
â”œâ”€ ==***ç¬¬ä¸€å±‚ï¼šServlet Filter é“¾ï¼ˆè¯·æ±‚å‰ç½®è¿‡æ»¤ï¼‰***==
â”‚  â”œâ”€ ğŸ”´ **CryptoFilter**ï¼ˆorder=-2147483648ï¼ŒApiDecryptAutoConfiguration.java:27ï¼‰ï¼šè¯·æ±‚/å“åº”åŠ å¯†è§£å¯†
â”‚  â”œâ”€ ğŸ”´ **XssFilter**ï¼ˆorder=-2147483647ï¼ŒFilterConfig.java:28ï¼‰ï¼šXSSæ”»å‡»è¿‡æ»¤ï¼Œæ¸…ç†å±é™©å­—ç¬¦
â”‚  â””â”€ ğŸ”´ **RepeatableFilter**ï¼ˆé»˜è®¤order=0ï¼ŒFilterConfig.java:36ï¼‰ï¼šåŒ…è£…HttpServletRequestï¼Œæ”¯æŒé‡å¤è¯»å–è¯·æ±‚ä½“
â”‚
â”œâ”€ ==***è¿›å…¥ DispatcherServlet åˆ†å‘è¯·æ±‚***==
â”‚
â”œâ”€ ==***ç¬¬äºŒå±‚ï¼šSpring MVC æ‹¦æˆªå™¨é“¾ï¼ˆè¯·æ±‚å‰ç½®æ ¡éªŒï¼‰***==
â”‚  â”œâ”€ ğŸŸ¡ **PlusWebInvokeTimeInterceptor**ï¼ˆResourcesConfig.java:31ï¼‰ï¼šè®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´å’Œå‚æ•°ï¼ŒpreHandleæ‰“å°è¯·æ±‚å¼€å§‹æ—¥å¿—
â”‚  â””â”€ ğŸŸ¡ **SaInterceptor**ï¼ˆSecurityConfig.java:51ï¼‰ï¼šSa-Tokenæ ¸å¿ƒæ‹¦æˆªï¼Œæ ¡éªŒç™»å½•/ClientId/æ¥å£æƒé™ï¼ˆ@SaCheckPermissionï¼‰ï¼Œæƒé™ä¸è¶³ç»ˆæ­¢è¯·æ±‚
â”‚
â”œâ”€==*** è¿›å…¥ SysUserController.add() æ§åˆ¶å™¨æ–¹æ³•***==
â”‚
â”œâ”€ ==***ç¬¬ä¸‰å±‚ï¼šAOP åˆ‡é¢é“¾ï¼ˆæ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œå‰åå¢å¼ºï¼‰***==
â”‚  â”œâ”€ æ‰§è¡Œå…¥å£ï¼šSysUserController.add(@RequestBody SysUserBo user)
â”‚  â”œâ”€ğŸŸ¢ **DataPermissionAdvice**ï¼ˆDataPermissionPointcutAdvisor.javaï¼‰ï¼šMapperå±‚@DataPermissionæ³¨è§£è§¦å‘ï¼ŒThreadLocalè®¾ç½®æ•°æ®æƒé™ä¿¡æ¯ï¼ˆControllerå±‚é€šå¸¸ä¸è§¦å‘ï¼‰
â”‚  â”œâ”€ğŸŸ¢ **RepeatSubmitAspect**ï¼ˆ@Beforeï¼ŒRepeatSubmitAspect.java:41ï¼‰ï¼š@RepeatSubmitæ³¨è§£è§¦å‘ï¼ŒMD5ç”Ÿæˆå”¯ä¸€keyï¼ŒRedisé˜²é‡å¤æäº¤ï¼Œå·²å­˜åœ¨åˆ™æŠ›å¼‚å¸¸
â”‚  â”œâ”€ğŸŸ¢ **LogAspect**ï¼ˆ@Beforeï¼ŒLogAspect.java:51ï¼‰ï¼š@Logæ³¨è§£è§¦å‘ï¼Œåˆ›å»ºStopWatchè®¡æ—¶å¹¶å­˜å…¥ThreadLocal
â”‚  â”‚
â”‚  â”œâ”€ æ‰§è¡Œ Controller æ–¹æ³•ä½“
â”‚  â”‚  â””â”€ deptService.checkDeptDataScope() â†’ userService.insertUser() â†’ è¿›å…¥SysUserService.insertUser()
â”‚  â”‚
â”œâ”€==*** ç¬¬å››å±‚ï¼šMyBatis-Plus æ‹¦æˆªå™¨é“¾ï¼ˆSQLæ‰§è¡Œæ—¶åŠ¨æ€å¤„ç†ï¼‰***==
â”‚  â”œâ”€ æ‰§è¡Œå…¥å£ï¼šSysUserMapper.insert(user) æ‰§è¡ŒINSERTè¯­å¥
â”‚  â”œâ”€ ğŸ”µ **TenantLineInnerInterceptor**ï¼ˆMybatisPlusConfig.java:42-46ï¼‰ï¼šå¤šç§Ÿæˆ·æ’ä»¶ï¼ŒSQLè‡ªåŠ¨æ‹¼æ¥tenant_idï¼ˆå¿…é¡»é¦–ä½ï¼‰ï¼ŒINSERTèµ‹å€¼/æŸ¥è¯¢ç±»è¯­å¥åŠ WHEREæ¡ä»¶
â”‚  â”œâ”€ ğŸ”µ **PlusDataPermissionInterceptor**ï¼ˆMybatisPlusConfig.java:48ï¼‰ï¼šæ•°æ®æƒé™æ‹¦æˆªï¼Œé‡å†™SQLWHEREæ¡ä»¶ï¼ˆINSERTé€šå¸¸ä¸è§¦å‘ï¼‰
â”‚  â”œâ”€ ğŸ”µ **PaginationInnerInterceptor**ï¼ˆMybatisPlusConfig.java:50ï¼‰ï¼šåˆ†é¡µæ’ä»¶ï¼ŒæŸ¥è¯¢è‡ªåŠ¨åŠ LIMITï¼ˆä»…æŸ¥è¯¢è§¦å‘ï¼‰
â”‚  â””â”€ ğŸ”µ **OptimisticLockerInnerInterceptor**ï¼ˆMybatisPlusConfig.java:52ï¼‰ï¼šä¹è§‚é”æ’ä»¶ï¼ŒUPDATEæ ¡éªŒversionå­—æ®µï¼ˆä»…æ›´æ–°è§¦å‘ï¼‰
â”‚
â”œâ”€ ==***æ‰§è¡ŒåŸç”Ÿ SQLï¼ŒSQLæ‰§è¡ŒæˆåŠŸè¿”å›ç»“æœ***==
â”‚
â”œâ”€ ==***ç¬¬äº”å±‚ï¼šè¿”å›æ—¶çš„åç½®å¤„ç†é“¾ï¼ˆç»“æœè¿”å›/èµ„æºæ¸…ç†/æ—¥å¿—è®°å½•ï¼‰***==
â”‚  â”œâ”€ ğŸŸ¢ **LogAspect**ï¼ˆ@AfterReturningï¼ŒLogAspect.java:63ï¼‰ï¼šåœæ­¢è®¡æ—¶ï¼Œæ„å»ºOperLogEventäº‹ä»¶ï¼Œå¼‚æ­¥å‘å¸ƒå¹¶ä¿å­˜æ“ä½œæ—¥å¿—åˆ°æ•°æ®åº“
â”‚  â”œâ”€ ğŸŸ¢ **RepeatSubmitAspect**ï¼ˆ@AfterReturningï¼ŒRepeatSubmitAspect.java:77ï¼‰ï¼šæ ¹æ®è¿”å›ç å¤„ç†Redis keyï¼ˆæˆåŠŸä¿ç•™/å¤±è´¥åˆ é™¤ï¼‰
â”‚  â””â”€ ğŸŸ¡ **PlusWebInvokeTimeInterceptor**ï¼ˆafterCompletionï¼ŒPlusWebInvokeTimeInterceptor.java:104ï¼‰ï¼šåœæ­¢è®¡æ—¶ï¼Œè¾“å‡ºè¯·æ±‚ç»“æŸåŠè€—æ—¶æ—¥å¿—



çŸ¥è¯†ç‚¹ï¼š
- FilterçŸ¥è¯†
	- åˆ›å»ºå’Œç®¡ç†
	- åº”ç”¨åœºæ™¯ä¸åº•å±‚é€»è¾‘
	- é‡æ–°è®¤è¯†Requestè¯·æ±‚ä½“çš„å¤„ç†
- æ‹¦æˆªå™¨çŸ¥è¯†ä½“ç³»
- AOPçŸ¥è¯†ä½“ç³»

